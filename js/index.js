var companies =
[{'name':'Apotek 1','category':'Helse og velvære','category_logo':'<i class="fas fa-heartbeat"></i>','price':'99','free_delivery_limit':'-','homepage':'http://apotek1.no','logo':'https://morenenkjopesenter.no/wp-content/uploads/2014/02/logo-apotek1.png'},{'name':'Vitusapotek','category':'Helse og velvære','category_logo':'<i class="fas fa-heartbeat"></i>','price':'99','free_delivery_limit':'-','homepage':'http://vitusapotek.no','logo':'https://images.squarespace-cdn.com/content/v1/5beb0ba8a2772c47a1392921/1543603980972-C2IE9HA4KR8AYPMMWEG5/ke17ZwdGBToddI8pDm48kL6ihLOnGesp-xL9jch5JeEUqsxRUqqbr1mOJYKfIPR7LoDQ9mXPOjoJoqy81S2I8N_N4V1vUb5AoIIIbLZhVYwL8IeDg6_3B-BRuF4nNrNcQkVuAT7tdErd0wQFEGFSnP5a5fnbVoLQRf69X016CfNJfbpQa87jnEIrMbWMh1cPd22pOepWSyIIsp8XMhdonw/Vitusapotek+logo.png'},{'name':'Lensway','category':'Helse og velvære','category_logo':'<i class="fas fa-heartbeat"></i>','price':'50','free_delivery_limit':'-','homepage':'http://lensway.no','logo':'https://res.cloudinary.com/lwg/image/upload/v1/static/lensway-logo.png'},{'name':'Plantasjen','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'99','free_delivery_limit':'-','homepage':'http://plantasjen.no','logo':'https://kommunikasjon.ntb.no/data/images/00891/5529ba67-d1e1-4edf-b3e7-b7adfd657d98-w_960_h_960.png'},{'name':'Jernia','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'29','free_delivery_limit':'-','homepage':'http://jernia.no','logo':'https://gunerius.no/globalassets/fellesgemensamt---webolavthon.no/-butikklogos/j/jernia2_logo.png'},{'name':'Jula','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'249','free_delivery_limit':'-','homepage':'http://jula.no','logo':'https://www.jula.no/Frontend/Build/images/logo.png'},{'name':'Europris','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'39','free_delivery_limit':'-','homepage':'http://europris.no','logo':'https://amfi.no/globalassets/fellesgemensamt---webolavthon.no/-butikklogos/e/europris-logo-500x300-px.png'},{'name':'Clas Ohlson','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'99','free_delivery_limit':'-','homepage':'http://clasohlson.com/no/','logo':'https://amfi.no/globalassets/fellesgemensamt---webolavthon.no/-butikklogos/c/clas-ohlson-logo-500x300-px.png'},{'name':'Adlibris','category':'Bøker og mer','category_logo':'<i class="fas fa-book"></i>','price':'42','free_delivery_limit':'-','homepage':'http://adlibris.no','logo':'https://logovectorseek.com/wp-content/uploads/2019/11/adlibris-logo-vector.png'},{'name':'Ark','category':'Bøker og mer','category_logo':'<i class="fas fa-book"></i>','price':'45','free_delivery_limit':'-','homepage':'http://ark.no','logo':'https://amfi.no/globalassets/amfi-no/amfi-felles/logoer/butikklogoer/a/ark-logo-500x300-px.png'},{'name':'Kid','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'69','free_delivery_limit':'-','homepage':'http://kid.no','logo':'https://ccvest.no/wp-content/uploads/2019/02/Kid-logo.png'},{'name':'Tilbords','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'79','free_delivery_limit':'-','homepage':'http://tilbords.no','logo':'https://www.tilbords.no/Styles/gfx/logo-tilbords_w.png'},{'name':'Kitchn','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'79','free_delivery_limit':'-','homepage':'http://kitchn.no','logo':'https://amfi.no/globalassets/amfi-no/amfi-felles/logoer/butikklogoer/k/kitchn-logo-500x300-px.png'},{'name':'Dressmann','category':'Klær, sko og tilbehør','category_logo':'<i class="fas fa-tshirt"></i>','price':'-','free_delivery_limit':'-','homepage':'http://dressmann.no','logo':'https://4.bp.blogspot.com/-f0Xr7ddXqSE/TWHT2FOKRkI/AAAAAAAAAQQ/eTM2CdZBuWU/s1600/Dressmann+logo+2011.png'},{'name':'Lindex','category':'Klær, sko og tilbehør','category_logo':'<i class="fas fa-tshirt"></i>','price':'39','free_delivery_limit':'249','homepage':'http://lindex.com/no','logo':'https://www.lindex.com/Assets/SiteV3/UI/logo.png'},{'name':'H&M','category':'Klær, sko og tilbehør','category_logo':'<i class="fas fa-tshirt"></i>','price':'79.9','free_delivery_limit':'300','homepage':'http://hm.com/no','logo':'https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/H%26M-Logo.svg/709px-H%26M-Logo.svg.png'},{'name':'Jack & Jones','category':'Klær, sko og tilbehør','category_logo':'<i class="fas fa-tshirt"></i>','price':'59','free_delivery_limit':'-','homepage':'https://www.jackjones.com/no/','logo':'https://cdn.freelogovectors.net/wp-content/uploads/2020/02/jack-jones-logo.png'},{'name':'Meny','category':'Mat og drikke','category_logo':'<i class="fas fa-carrot"></i>','price':'fra 59','free_delivery_limit':'-','homepage':'http://meny.no','logo':'https://kommunikasjon.ntb.no/data/images/00999/4841e2e2-2bae-4bdc-84e7-385c1b7b0855-w_960_h_960.png'},{'name':'Kolonial.no','category':'Mat og drikke','category_logo':'<i class="fas fa-carrot"></i>','price':'fra 0','free_delivery_limit':'-','homepage':'http://kolonial.no','logo':'http://matkasser.com/wp-content/uploads/2016/09/kolonialno-main.png'},{'name':'Morgenlevering','category':'Mat og drikke','category_logo':'<i class="fas fa-carrot"></i>','price':'4.9','free_delivery_limit':'150','homepage':'http://morgenlevering.no','logo':'http://matkasser.com/wp-content/uploads/2016/09/Morgenlevering-300x300.png'},{'name':'Adams matkasse','category':'Matkasser','category_logo':'<i class="fas fa-box-open"></i>','price':'-','free_delivery_limit':'-','homepage':'http://adamsmatkasse.no','logo':'http://teknojobb.no/kunder/teknojobb/images/ad_6518_godtlevertadamsmatkasse.png'},{'name':'Godt levert','category':'Matkasser','category_logo':'<i class="fas fa-box-open"></i>','price':'-','free_delivery_limit':'-','homepage':'http://godtlevert.no','logo':'https://godtlevert.no/assets/icons/logo-full.svg'},{'name':'Helthjem','category':'Send og motta pakke','category_logo':'<i class="fas fa-shipping-fast"></i>','price':'fra 75','free_delivery_limit':'-','homepage':'http://helthjem.no','logo':'https://s3-eu-west-1.amazonaws.com/tpd/logos/59d3a1240000ff0005acb1c5/0x0.png'},{'name':'wolt','category':'Take-away','category_logo':'<i class="fas fa-pizza-slice"></i>','price':'-','free_delivery_limit':'-','homepage':'https://wolt.com/','logo':'https://upload.wikimedia.org/wikipedia/commons/8/88/Wolt_logo_black.png'},{'name':'Foodora','category':'Take-away','category_logo':'<i class="fas fa-pizza-slice"></i>','price':'-','free_delivery_limit':'-','homepage':'https://www.foodora.no/','logo':'https://kroathai.com/wp-content/uploads/foodora-logo.png'},{'name':'svosj','category':'Send og motta pakke','category_logo':'<i class="fas fa-shipping-fast"></i>','price':'29 / mnd','free_delivery_limit':'-','homepage':'https://svosj.no','logo':'https://upload.wikimedia.org/wikipedia/commons/0/07/Svosj-logo.svg'},{'name':'IKEA','category':'Interiør, gave og hobby','category_logo':'<i class="fas fa-wrench"></i>','price':'49','free_delivery_limit':'-','homepage':'https://www.ikea.com/','logo':'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Ikea_logo.svg/800px-Ikea_logo.svg.png'},{'name':'Specsavers','category':'Helse og velvære','category_logo':'<i class="fas fa-heartbeat"></i>','price':'49','free_delivery_limit':'-','homepage':'http://specsavers.no','logo':'https://www.google.com/url?sa=i&url=https%3A%2F%2Fcommons.wikimedia.org%2Fwiki%2FFile%3ASpecsavers_logo.svg&psig=AOvVaw2Knh0DEJs1_4zsNjJapFPP&ust=1585147207813000&source=images&cd=vfe&ved=0CAIQjRxqFwoTCODXz9Ors-gCFQAAAAAdAAAAABAD'}];


var categories = [];

function addCategory(category, category_logo, category_id) {
  $('.company-list').append('<p class="category-name" id="category_name_'+category_id+'"><span class="category-logo">'+category_logo+'</span>'+category+'<i class="arrow-icon fas fa-chevron-down"></i></p>');
  $('.company-list').append('<div class="category" id="category_'+category_id+'"></div>');
  $('#category_'+category_id).append('<div class="companies"> </div>');
}

function addCompany(company, category_id, company_id) {
  $('#'+category_id+ ' .companies').append('<a target="_blank" href="'+company.homepage+'"><div class="company" id="company_'+company_id+'"><div class="company-name">'+company.name+'</div><div class="company-specs"><div class="spec"><p class="spec-title">LEVERING PRIS</p><p class="price-from">'+company.price+'</p></div><div class="spec"><p class="spec-title">FRIFRAKT GRENSE</p><p class="price-from">'+company.free_delivery_limit+'</p></div></div></div></div></a>');
  //$('#company_'+company_id+' .company-logo').css("background-image", "url(" + company.logo + ")");
}

function findCategoryID(category){
  for (var i in categories) {
    if(categories[i][0] === category){
      return parseInt(i)+1;
    }
  }
  return false;
}

function addFilters(){
  for (var i in categories) {
    $('.filters').append('<div class="filter filter-select filter-noselect" data-category="'+(parseInt(i)+1)+'">'+categories[i][0]+'</div>');
  }
}

function setCurrentCity() {
  $.ajax({
    url: "https://geolocation-db.com/jsonp",
    jsonpCallback: "callback",
    dataType: "jsonp",
    success: function(location) {
      $('input[name=delivery_area]').val(location.city);
    }
  });
}


var can_send_form = true;
$(document).ready(function(){
  setCurrentCity();

  for (var i in companies){
    let temp_category = companies[i].category;
    let temp_category_logo = companies[i].category_logo;
    if(findCategoryID(temp_category, categories) === false){
      categories.push([temp_category, temp_category_logo]);
    }
  }

  let id = 1;
  for (var i in categories){
    addCategory(categories[i][0], categories[i][1], id);
    id++;
  }


  let company_id = 1;
  for (company of companies){
    let category = findCategoryID(company.category, categories);

    if(category){
      let category_id = 'category_'+ category;
      addCompany(company, category_id, company_id);
      company_id ++;
    }
  }
});

$("#contact-form").on('submit', function(event) {
  event.preventDefault();
  if(can_send_form){
    $('#contact-form-status').toggleClass('hidden');
    $('#contact-form-status').toggleClass('slide-from-top');
    $('#contact-form-status-black-panel').toggleClass('hidden');

    can_send_form = false;

    let form = this;

    var template_params = {
      "name": form.company_name.value,
      "webpage": form.company_webpage.value,
      "area": form.delivery_area.value
    }
    // generate the contact number value
    form.contact_number.value = Math.random() * 100000 | 0;
    emailjs.send('gmail', 'template_p1yp4L7J', template_params)
    .then(function(response) {
       if(response.status === 200) {
         form.reset();
         $('#contact-form-status').html('<i class="fas fa-check-circle"></i><div class="text">Ditt forslag har blitt sendt. Tusen takk!</div>');
         setTimeout(function(){
           $('#contact-form-status').toggleClass('slide-to-top');
           setTimeout(function(){
             //toggle
             $('#contact-form-status-black-panel').toggleClass('hidden');
             $('#contact-form-status').toggleClass('hidden');
             //untoggle
             $('#contact-form-status').toggleClass('slide-to-top');
             $('#contact-form-status').toggleClass('slide-from-top');
           }, 350);
         }, 2000);
       }
    }, function(error) {
        $('#contact-form-status').html('<i class="fas fa-times-circle"></i><div class="text">Det oppsto et problem. Vent litt og prøv igjen.</div>');
        setTimeout(function(){
          $('#contact-form-status').toggleClass('slide-to-top');
          setTimeout(function(){
            //toggle
            $('#contact-form-status-black-panel').toggleClass('hidden');
            $('#contact-form-status').toggleClass('hidden');
            //untoggle
            $('#contact-form-status').toggleClass('slide-to-top');
            $('#contact-form-status').toggleClass('slide-from-top');
          }, 350);
        }, 2000);
    });

    $('#contact-form-status').html('<i class="fa fa-spinner rotate"></i>');
    can_send_form = true;
    setCurrentCity();
  }
});

$(document).on('click', '.filter', function(){
  let filter = $(this);

  filter.toggleClass('filter-noselect');

  let category_id = filter.data('category');

  $('#category_'+category_id).toggleClass('hidden');
  $('#category_name_'+category_id).toggleClass('hidden');
});

$(document).on('click', '.category-name', function(){
  let category = $(this);

  category.toggleClass('category-name-expanded')
  category.children('.arrow-icon').toggleClass('fa-chevron-down');
  category.children('.arrow-icon').toggleClass('fa-chevron-up');
  let category_id = category.attr('id').split("_")[2];

  $('#category_'+category_id).toggleClass('category-expanded')
});

$(document).on('click', '.continue-reading', function(){
  $('html, body').animate({
      scrollTop: $("#content").offset().top
  }, 500);
});

$(document).on('click', '.contact-button', function(){
  $('html, body').animate({
      scrollTop: $(document).height()
  }, 500);
});

(function(){
   emailjs.init('user_Dwhh6K9MG3QhBbgWIk4O5');
})();
